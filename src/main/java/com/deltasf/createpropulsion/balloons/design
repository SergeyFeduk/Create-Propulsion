

# Concepts:

Hai - Hot Air Injector is a seed for a balloon. Each hai must be witin one HaiGroup.

Hab - Hot Air Balloon is a building block from which most of the balloon's envelope is made. It is one of a few blocks that are allowed to be used in air-tight envelope. 

HaiGroup - A set of Hais with intersecting aabbs. HaiGroup must contain at least one hai. It may contain one or more balloons. 

RLE volume - A precise volume identical to the union of aabbs of all hais in HaiGroup. Currently it is stored as a Run-Length-Encoded sequence of coordinates. Used to check if the given voxel is within the allowed region of HaiGroup. 

Balloon - A gameplay object, stored in HaiGroup. Each balloon stores its interior volume, aabb of that volume, a list of supporting hais, and a list of holes. Some additional data (like the amount of hot air) will be added in the future. 

Leak - is an event that may occur during the scan process. Leak is defined as an event when 2D bfs or vertical check exits RLE volume. The result of the leak varies and depends on the context the scan happened. 

Dynamic Update - an event that occurs when hab block is placed/removed near the hot air balloon (inside of the volume or on the shell). Goal of the dynamic update is to keep the balloon valid without performing a complete scan once again (this is avoided due to performance reasons). There are 3 possible outcomes of dynamic update: addition of hole(s), merging of multiple volumes (can be balloons or simple DiscoveredVolumes), splitting of the balloon(s). Dynamic updates are handled in a deferred way, meaning they are processed in groups on server ticks.  

Hole - is a object that may be created via dynamic update only. Holes are created upon hab block removal, if the removed block was a part of the shell and performed scan returned a leaky discovered volume - the BlockPos of removed hab is marked as a hole and added into the balloon. 

Scan - A complex :( procedure of obtaining a DiscoveredVolume from the given seed position, RLE Volume and an optional set of excluded positions. Scan is used both in base scanning from hai seeds, and during dynamic updates.

DiscoveredVolume - a record containing a set of discovered blocks as well as the fact of the volume being leaky or not. Leaky volume in most cases means that volume does not contain all available voxels, as scanning them would hurt the performance too much. 

# Rules:

1) All balloons must be valid at any given moment
2) Valid balloon must met a set of criterions:
- All volume of the balloon must be contained within RLE volume of haiGroup it is in
- There must be at least one hai below the balloon's open bottom. Vertical distance between the bottom-most voxel and hai must be <= HAI_TO_BALLOON_DIST
- Balloon must contain at least one block in its volume

3) Dynamic update must result in one of the following states of the haiGroup it affected:
- Single balloon volume change
- Single balloon state change (hole addition/removal)
- Single balloon split into multiple balloons
- Single balloon + discovered volume merge
- Merge of multiple balloons

# Constants:

HAI_AABB_SIZE = 17 - not 16 as aabb is centered around the hai block
VERTICAL_ANOMALY_SCAN_DISTANCE = 32 - maximum distance for performing anomaly vertical probe during the scan process. 